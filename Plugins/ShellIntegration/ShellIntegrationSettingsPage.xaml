<UserControl x:Class="LenovoLegionToolkit.Plugins.ShellIntegration.ShellIntegrationSettingsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:wpfui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:utils="clr-namespace:LenovoLegionToolkit.WPF.Utils"
             ScrollViewer.CanContentScroll="True"
             ScrollViewer.VerticalScrollBarVisibility="Auto">

    <UserControl.Resources>
        <!-- Card Style -->
        <Style x:Key="SettingsCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="20" />
            <Setter Property="Margin" Value="0,0,0,16" />
        </Style>
        
        <!-- Header Style -->
        <Style x:Key="SettingsHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>
        
        <!-- List Item Style -->
        <Style x:Key="ListItemStyle" TargetType="Border">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="0,0,0,1" />
            <Setter Property="Padding" Value="0,12,0,12" />
        </Style>
        
        <!-- Toggle Button Style -->
        <Style x:Key="ToggleStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="48" />
            <Setter Property="Height" Value="24" />
            <Setter Property="Margin" Value="8,0,0,0" />
        </Style>
    </UserControl.Resources>

    <Grid Margin="0,0,16,12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,16,0,24">
            <TextBlock Text="{Binding PageTitle}"
                       FontSize="22"
                       FontWeight="Medium"
                       Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
            <TextBlock Text="{Binding PageDescription}"
                       Margin="0,4,0,0"
                       FontSize="14"
                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
        </StackPanel>

        <!-- Context Menu Items -->
        <Border Grid.Row="1" Style="{StaticResource SettingsCardStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                    <wpfui:SymbolIcon Symbol="List24"
                                       FontSize="20"
                                       Margin="0,0,8,0"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource SystemAccentColorBrush}" />
                    <TextBlock Text="Context Menu Items"
                               Style="{StaticResource SettingsHeaderStyle}" />
                    <Button Content="Reset to Defaults"
                            Click="ResetMenuItems_Click"
                            Icon="ArrowReset24"
                            Appearance="Secondary"
                            Height="32"
                            Width="140"
                            Margin="16,0,0,0"
                            HorizontalAlignment="Left" />
                    <Button Content="Refresh"
                            Click="RefreshButton_Click"
                            Icon="ArrowClockwise24"
                            Appearance="Secondary"
                            Height="32"
                            Width="80"
                            Margin="8,0,0,0"
                            HorizontalAlignment="Left" />
                </StackPanel>

                <!-- Column Headers -->
                <Grid Grid.Row="1" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="Name" FontWeight="Medium" />
                    <TextBlock Grid.Column="1" Text="Category" FontWeight="Medium" />
                    <TextBlock Grid.Column="2" Text="Command" FontWeight="Medium" />
                    <TextBlock Grid.Column="3" Text="Status" FontWeight="Medium" HorizontalAlignment="Center" />
                </Grid>

                <!-- Menu Items List -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" MaxHeight="300">
                    <ItemsControl ItemsSource="{Binding MenuItems}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource ListItemStyle}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontWeight="Medium" />
                                            <TextBlock Text="{Binding Description}" 
                                                       FontSize="12"
                                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                        </StackPanel>
                                        
                                        <TextBlock Grid.Column="1" 
                                                   Text="{Binding Category}"
                                                   VerticalAlignment="Center"
                                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                        
                                        <TextBlock Grid.Column="2" 
                                                   Text="{Binding Command}"
                                                   VerticalAlignment="Center"
                                                   Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                                   FontSize="12" />
                                        
                                        <ToggleButton Grid.Column="3"
                                                     IsChecked="{Binding IsEnabled}"
                                                     Click="ToggleMenuItem_Click"
                                                     Tag="{Binding Id}"
                                                     Style="{StaticResource ToggleStyle}"
                                                     HorizontalAlignment="Center" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Shell Extensions -->
        <Border Grid.Row="2" Style="{StaticResource SettingsCardStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                    <wpfui:SymbolIcon Symbol="AppFolder24"
                                       FontSize="20"
                                       Margin="0,0,8,0"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource SystemAccentColorBrush}" />
                    <TextBlock Text="Shell Extensions"
                               Style="{StaticResource SettingsHeaderStyle}" />
                </StackPanel>

                <!-- Column Headers -->
                <Grid Grid.Row="1" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="Name" FontWeight="Medium" />
                    <TextBlock Grid.Column="1" Text="Type" FontWeight="Medium" />
                    <TextBlock Grid.Column="2" Text="Version" FontWeight="Medium" />
                    <TextBlock Grid.Column="3" Text="System" FontWeight="Medium" HorizontalAlignment="Center" />
                    <TextBlock Grid.Column="4" Text="Status" FontWeight="Medium" HorizontalAlignment="Center" />
                </Grid.ColumnDefinitions>
                
                <!-- Extensions List -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" MaxHeight="300">
                    <ItemsControl ItemsSource="{Binding Extensions}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource ListItemStyle}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontWeight="Medium" />
                                            <TextBlock Text="{Binding Description}" 
                                                       FontSize="12"
                                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                        </StackPanel>
                                        
                                        <TextBlock Grid.Column="1" 
                                                   Text="{Binding Type}"
                                                   VerticalAlignment="Center"
                                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                        
                                        <TextBlock Grid.Column="2" 
                                                   Text="{Binding Version}"
                                                   VerticalAlignment="Center"
                                                   Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                                   FontSize="12" />
                                        
                                        <TextBlock Grid.Column="3" 
                                                   Text="{Binding IsSystem, Converter={StaticResource BooleanToYesNoConverter}}"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Center"
                                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                        
                                        <ToggleButton Grid.Column="4"
                                                     IsChecked="{Binding IsEnabled}"
                                                     IsEnabled="{Binding IsSystem, Converter={StaticResource InverseBooleanConverter}}"
                                                     Click="ToggleExtension_Click"
                                                     Tag="{Binding Id}"
                                                     Style="{StaticResource ToggleStyle}"
                                                     HorizontalAlignment="Center" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>