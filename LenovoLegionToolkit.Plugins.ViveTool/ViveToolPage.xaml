<wpfui:UiPage
    x:Class="LenovoLegionToolkit.Plugins.ViveTool.ViveToolPage"
    x:Name="PageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:wpfui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:plugin="clr-namespace:LenovoLegionToolkit.Plugins.ViveTool"
    xmlns:conv="clr-namespace:System.Windows.Controls;assembly=PresentationFramework"
    UseLayoutRounding="True"
    SnapsToDevicePixels="True"
    TextOptions.TextFormattingMode="Display"
    TextOptions.TextRenderingMode="Auto"
    FlowDirection="LeftToRight"
    Scrollable="False"
    Loaded="Page_Loaded"
    Unloaded="Page_Unloaded">
    
    <wpfui:UiPage.Resources>
        <conv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <plugin:FeatureStatusConverter x:Key="FeatureStatusConverter" />
    </wpfui:UiPage.Resources>

    <Grid Margin="0,0,16,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Content -->
        <ScrollViewer 
            x:Name="_contentScrollViewer"
            Grid.Row="0" 
            Grid.RowSpan="2" 
            VerticalScrollBarVisibility="Auto"
            HorizontalScrollBarVisibility="Disabled"
            PanningMode="VerticalOnly">
            <StackPanel Margin="0,0,0,0">
                
                <!-- Header with Description -->
                <StackPanel Margin="0,16,0,28">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock
                            AutomationProperties.Name="{Binding RelativeSource={RelativeSource Mode=Self}, Path=Text}"
                            Focusable="True"
                            FontSize="28"
                            FontWeight="Medium"
                            Text="{x:Static plugin:Resource.ViveTool_PageTitle}" />
                        <TextBlock
                            Margin="0,6,0,0"
                            FontSize="14"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            TextWrapping="Wrap"
                            Text="{x:Static plugin:Resource.ViveTool_PageDescription}"
                            LineHeight="20" />
                    </StackPanel>
                </StackPanel>
                
                <!-- Warning Message -->
                <Border
                    Background="{DynamicResource SystemFillColorCautionBackgroundBrush}"
                    BorderBrush="{DynamicResource SystemFillColorCautionBrush}"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="20"
                    Margin="0,0,0,24">
                    <StackPanel>
                        <TextBlock
                            FontSize="15"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource SystemFillColorCautionBrush}"
                            Margin="0,0,0,8"
                            Text="{x:Static plugin:Resource.ViveTool_WarningTitle}" />
                        <TextBlock
                            FontSize="13"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            TextWrapping="Wrap"
                            LineHeight="18"
                            Text="{x:Static plugin:Resource.ViveTool_WarningMessage}" />
                    </StackPanel>
                </Border>

                <!-- ViVeTool Status -->
                <Border
                    Background="{DynamicResource ControlFillColorDefaultBrush}"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="24"
                    Margin="0,0,0,20">
                    <Border.Effect>
                        <DropShadowEffect
                            Color="Black"
                            Direction="270"
                            ShadowDepth="2"
                            Opacity="0.08"
                            BlurRadius="8" />
                    </Border.Effect>
                    <StackPanel>
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <TextBlock
                                    FontSize="17"
                                    FontWeight="Medium"
                                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                    Text="{x:Static plugin:Resource.ViveTool_ViveToolStatus}" />
                                <TextBlock
                                    FontSize="13"
                                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                    Margin="0,4,0,0"
                                    TextWrapping="Wrap"
                                    Text="{Binding ViveToolStatusDescription, Mode=OneWay}"
                                    LineHeight="18" />
                                    
                                <!-- Download Progress -->
                                <Grid Margin="0,8,0,0" Visibility="{Binding IsDownloading, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <ProgressBar
                                        x:Name="_downloadProgressBar"
                                        Height="8"
                                        Background="{DynamicResource ControlFillColorTertiaryBrush}"
                                        BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        Foreground="{DynamicResource SystemAccentColorPrimaryBrush}"
                                        Value="{Binding DownloadProgress, Mode=OneWay}"
                                        Maximum="100"
                                        HorizontalAlignment="Stretch" />
                                    <TextBlock
                                        x:Name="_downloadProgressText"
                                        FontSize="12"
                                        Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                        Margin="0,12,0,0"
                                        Text="{Binding DownloadProgressText, Mode=OneWay}" />
                                </Grid>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <wpfui:Button
                                    x:Name="_downloadViveToolButton"
                                    Content="{x:Static plugin:Resource.ViveTool_Download}"
                                    Click="DownloadViveToolButton_Click"
                                    Padding="12,6"
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    IsEnabled="{Binding IsNotDownloading}" />
                                <wpfui:Button
                                    x:Name="_browseViveToolButton"
                                    Content="{x:Static plugin:Resource.ViveTool_Browse}"
                                    Click="BrowseViveToolButton_Click"
                                    Padding="12,6"
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center" />
                                <wpfui:Button
                                    x:Name="_refreshStatusButton"
                                    Content="{x:Static plugin:Resource.ViveTool_Refresh}"
                                    Click="RefreshStatusButton_Click"
                                    Padding="12,6"
                                    VerticalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Search and Filter -->
                <Border
                    Background="{DynamicResource ControlFillColorDefaultBrush}"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="24"
                    Margin="0,0,0,20"
                    Visibility="{Binding IsViveToolAvailable, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Border.Effect>
                        <DropShadowEffect
                            Color="Black"
                            Direction="270"
                            ShadowDepth="2"
                            Opacity="0.08"
                            BlurRadius="8" />
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock
                            FontSize="17"
                            FontWeight="Medium"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            Margin="0,0,0,12"
                            Text="{x:Static plugin:Resource.ViveTool_SearchFeatures}" />
                        <wpfui:TextBox
                            x:Name="_searchTextBox"
                            PlaceholderText="{x:Static plugin:Resource.ViveTool_SearchPlaceholder}"
                            TextChanged="SearchTextBox_TextChanged"
                            Margin="0,0,0,12" />
                        <wpfui:Button
                            x:Name="_searchButton"
                            Content="{x:Static plugin:Resource.ViveTool_Search}"
                            Click="SearchButton_Click"
                            HorizontalAlignment="Right"
                            Padding="12,6" />
                    </StackPanel>
                </Border>

                <!-- Feature Flags List -->
                <Border
                    Background="{DynamicResource ControlFillColorDefaultBrush}"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="24"
                    Margin="0,0,0,20"
                    Visibility="{Binding IsViveToolAvailable, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Border.Effect>
                        <DropShadowEffect
                            Color="Black"
                            Direction="270"
                            ShadowDepth="2"
                            Opacity="0.08"
                            BlurRadius="8" />
                    </Border.Effect>
                    <StackPanel>
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Grid.Column="0"
                                FontSize="17"
                                FontWeight="Medium"
                                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                Text="{x:Static plugin:Resource.ViveTool_FeatureFlags}" />
                            <wpfui:Button
                                Grid.Column="1"
                                x:Name="_importButton"
                                Content="{x:Static plugin:Resource.ViveTool_Import}"
                                Click="ImportButton_Click"
                                Padding="12,6"
                                Margin="0,0,8,0" />
                            <wpfui:Button
                                Grid.Column="2"
                                x:Name="_refreshListButton"
                                Content="{x:Static plugin:Resource.ViveTool_RefreshList}"
                                Click="RefreshListButton_Click"
                                Padding="12,6" />
                        </Grid>
                        
                        <!-- Loading Indicator -->
                        <StackPanel
                            x:Name="_loadingPanel"
                            Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            Margin="0,20,0,20"
                            Visibility="Collapsed">
                            <wpfui:ProgressRing
                                IsIndeterminate="True"
                                Width="20"
                                Height="20"
                                Margin="0,0,12,0" />
                            <TextBlock
                                FontSize="14"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                Text="{x:Static plugin:Resource.ViveTool_Loading}" />
                        </StackPanel>

                        <!-- Feature Flags DataGrid -->
                        <DataGrid
                            x:Name="_featuresDataGrid"
                            AutoGenerateColumns="False"
                            IsReadOnly="True"
                            SelectionMode="Single"
                            HeadersVisibility="Column"
                            GridLinesVisibility="Horizontal"
                            RowHeight="40"
                            MaxHeight="600"
                            ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <DataGrid.Columns>
                                <DataGridTextColumn
                                    Header="{x:Static plugin:Resource.ViveTool_FeatureId}"
                                    Binding="{Binding Id}"
                                    Width="100" />
                                <DataGridTextColumn
                                    Header="{x:Static plugin:Resource.ViveTool_FeatureName}"
                                    Binding="{Binding Name}"
                                    Width="*" />
                                <DataGridTextColumn
                                    Header="{x:Static plugin:Resource.ViveTool_Status}"
                                    Binding="{Binding Status, Converter={StaticResource FeatureStatusConverter}}"
                                    Width="120" />
                                <DataGridTemplateColumn
                                    Header="{x:Static plugin:Resource.ViveTool_Actions}"
                                    Width="200">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <wpfui:Button
                                                    Content="{x:Static plugin:Resource.ViveTool_Enable}"
                                                    Click="EnableFeatureButton_Click"
                                                    Tag="{Binding Id}"
                                                    Padding="8,4"
                                                    Margin="0,0,8,0"
                                                    FontSize="12" />
                                                <wpfui:Button
                                                    Content="{x:Static plugin:Resource.ViveTool_Disable}"
                                                    Click="DisableFeatureButton_Click"
                                                    Tag="{Binding Id}"
                                                    Padding="8,4"
                                                    FontSize="12" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Empty State -->
                        <StackPanel
                            x:Name="_emptyStatePanel"
                            HorizontalAlignment="Center"
                            Margin="0,40,0,40"
                            Visibility="Collapsed">
                            <TextBlock
                                FontSize="16"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                TextAlignment="Center"
                                Text="{x:Static plugin:Resource.ViveTool_NoFeaturesFound}" />
                        </StackPanel>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>

</wpfui:UiPage>
