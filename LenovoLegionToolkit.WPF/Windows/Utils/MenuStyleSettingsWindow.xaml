<local:BaseWindow
    x:Class="LenovoLegionToolkit.WPF.Windows.Utils.MenuStyleSettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:wpfui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:resources="clr-namespace:LenovoLegionToolkit.WPF.Resources"
    xmlns:local="clr-namespace:LenovoLegionToolkit.WPF.Windows"
    xmlns:conv="clr-namespace:System.Windows.Controls;assembly=PresentationFramework"
    xmlns:utils="clr-namespace:LenovoLegionToolkit.WPF.Utils"
    Title="{x:Static resources:Resource.SystemBeautification_MenuStyleSettings_Title}"
    Height="600"
    Width="800"
    WindowStartupLocation="CenterOwner"
    ResizeMode="CanResize"
    ShowInTaskbar="False"
    FlowDirection="{x:Static utils:LocalizationHelper.Direction}">

    <Window.Resources>
        <conv:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <!-- Browser-style Tab RadioButton Style -->
        <Style TargetType="RadioButton" x:Key="ConfigTabRadioButtonStyle">
            <Setter Property="Margin" Value="0,0,0,0" />
            <Setter Property="Padding" Value="20,10" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
            <Setter Property="Background" Value="{DynamicResource ControlFillColorTertiaryBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="1,1,1,0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border
                            x:Name="RootBorder"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="8,8,0,0"
                            Padding="{TemplateBinding Padding}"
                            Margin="{TemplateBinding Margin}">
                            <ContentPresenter
                                x:Name="ContentPresenter"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                RecognizesAccessKey="True"
                                Content="{TemplateBinding Content}"
                                ContentTemplate="{TemplateBinding ContentTemplate}"
                                TextElement.FontWeight="{TemplateBinding FontWeight}"
                                TextElement.FontSize="{TemplateBinding FontSize}"
                                TextElement.Foreground="{TemplateBinding Foreground}" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}" />
                                <Setter TargetName="RootBorder" Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                                <Setter TargetName="RootBorder" Property="BorderThickness" Value="1,1,1,0" />
                                <Setter TargetName="RootBorder" Property="Margin" Value="0,-4,0,0" />
                                <Setter TargetName="RootBorder" Property="Padding" Value="20,14" />
                                <Setter TargetName="ContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsChecked" Value="False">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorTertiaryBrush}" />
                                <Setter TargetName="RootBorder" Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                                <Setter TargetName="RootBorder" Property="Padding" Value="20,10" />
                                <Setter TargetName="ContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                                <Setter TargetName="ContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsChecked" Value="True" />
                                    <Condition Property="IsMouseOver" Value="True" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                            </MultiTrigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}" />
                                <Setter TargetName="RootBorder" Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                                <Setter TargetName="ContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource TextFillColorTertiaryBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Instructions -->
        <wpfui:CardControl Grid.Row="0" Margin="20,20,20,12">
            <wpfui:CardControl.Header>
                <TextBlock
                    FontSize="16"
                    FontWeight="Medium"
                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                    Text="使用说明" />
            </wpfui:CardControl.Header>
            <StackPanel Margin="0,8,0,0">
                <TextBlock
                    FontSize="13"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    TextWrapping="Wrap"
                    LineHeight="20"
                    Margin="0,0,0,8">
                    <Run Text="此编辑器用于直接编辑 shell.nss 配置文件。修改后点击" />
                    <Run Text="应用" FontWeight="Bold" />
                    <Run Text="按钮将保存所有更改并重启资源管理器使配置生效。" />
                </TextBlock>
                <TextBlock
                    FontSize="13"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    TextWrapping="Wrap"
                    LineHeight="20"
                    Margin="0,0,0,8">
                    <Run Text="• 配置文件路径：" FontWeight="Bold" />
                    <Run x:Name="_configPathTextBlock" />
                </TextBlock>
                <TextBlock
                    FontSize="13"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    TextWrapping="Wrap"
                    LineHeight="20">
                    <Run Text="• 修改配置后，需要重启资源管理器（Explorer）才能生效。" />
                </TextBlock>
            </StackPanel>
        </wpfui:CardControl>

        <!-- Text Editor with Tabs -->
        <wpfui:CardControl Grid.Row="1" Margin="20,0,20,12">
            <Grid Margin="0,8,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="1" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Tab Navigation -->
                <Border
                    Grid.Row="0"
                    Background="Transparent"
                    Margin="0,0,0,0"
                    ClipToBounds="False">
                    <ScrollViewer
                        VerticalScrollBarVisibility="Disabled"
                        HorizontalScrollBarVisibility="Auto"
                        VerticalContentAlignment="Center"
                        ClipToBounds="False">
                        <Border Padding="0,2,0,0" ClipToBounds="False">
                            <StackPanel Orientation="Horizontal" ClipToBounds="False">
                                <RadioButton
                                    x:Name="_shellNssTab"
                                    Style="{StaticResource ConfigTabRadioButtonStyle}"
                                    GroupName="ConfigFileTabs"
                                    Content="shell.nss"
                                    IsChecked="True"
                                    Checked="ShellNssTab_Checked" />
                                <RadioButton
                                    x:Name="_themeNssTab"
                                    Style="{StaticResource ConfigTabRadioButtonStyle}"
                                    GroupName="ConfigFileTabs"
                                    Content="theme.nss"
                                    Checked="ThemeNssTab_Checked" />
                                <RadioButton
                                    x:Name="_imagesNssTab"
                                    Style="{StaticResource ConfigTabRadioButtonStyle}"
                                    GroupName="ConfigFileTabs"
                                    Content="images.nss"
                                    Checked="ImagesNssTab_Checked" />
                                <RadioButton
                                    x:Name="_modifyNssTab"
                                    Style="{StaticResource ConfigTabRadioButtonStyle}"
                                    GroupName="ConfigFileTabs"
                                    Content="modify.nss"
                                    Checked="ModifyNssTab_Checked" />
                            </StackPanel>
                        </Border>
                    </ScrollViewer>
                </Border>

                <!-- Separator Line -->
                <Border 
                    Grid.Row="1"
                    Height="1"
                    Background="{DynamicResource ControlStrokeColorDefaultBrush}"
                    HorizontalAlignment="Stretch"
                    SnapsToDevicePixels="True" />

                <!-- Tab Content -->
                <Grid Grid.Row="2">
                    <ScrollViewer
                        x:Name="_shellNssScrollViewer"
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Auto"
                        Visibility="{Binding IsChecked, ElementName=_shellNssTab, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBox
                            x:Name="_shellNssTextBox"
                            FontFamily="Consolas, Courier New"
                            FontSize="12"
                            AcceptsReturn="True"
                            AcceptsTab="True"
                            TextWrapping="NoWrap"
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Auto"
                            MinHeight="400"
                            Background="{DynamicResource ControlFillColorDefaultBrush}"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            Padding="8" />
                    </ScrollViewer>
                    
                    <ScrollViewer
                        x:Name="_themeNssScrollViewer"
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Auto"
                        Visibility="{Binding IsChecked, ElementName=_themeNssTab, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBox
                            x:Name="_themeNssTextBox"
                            FontFamily="Consolas, Courier New"
                            FontSize="12"
                            AcceptsReturn="True"
                            AcceptsTab="True"
                            TextWrapping="NoWrap"
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Auto"
                            MinHeight="400"
                            Background="{DynamicResource ControlFillColorDefaultBrush}"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            Padding="8" />
                    </ScrollViewer>
                    
                    <ScrollViewer
                        x:Name="_imagesNssScrollViewer"
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Auto"
                        Visibility="{Binding IsChecked, ElementName=_imagesNssTab, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBox
                            x:Name="_imagesNssTextBox"
                            FontFamily="Consolas, Courier New"
                            FontSize="12"
                            AcceptsReturn="True"
                            AcceptsTab="True"
                            TextWrapping="NoWrap"
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Auto"
                            MinHeight="400"
                            Background="{DynamicResource ControlFillColorDefaultBrush}"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            Padding="8" />
                    </ScrollViewer>
                    
                    <ScrollViewer
                        x:Name="_modifyNssScrollViewer"
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Auto"
                        Visibility="{Binding IsChecked, ElementName=_modifyNssTab, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBox
                            x:Name="_modifyNssTextBox"
                            FontFamily="Consolas, Courier New"
                            FontSize="12"
                            AcceptsReturn="True"
                            AcceptsTab="True"
                            TextWrapping="NoWrap"
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Auto"
                            MinHeight="400"
                            Background="{DynamicResource ControlFillColorDefaultBrush}"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            Padding="8" />
                    </ScrollViewer>
                </Grid>
            </Grid>
        </wpfui:CardControl>

        <StackPanel
            Grid.Row="2"
            Margin="20"
            HorizontalAlignment="Right"
            Orientation="Horizontal">
            <wpfui:Button
                x:Name="_applyButton"
                MinWidth="120"
                Margin="0,0,8,0"
                Click="ApplyButton_Click"
                Content="应用" />
            <wpfui:Button
                x:Name="_closeButton"
                MinWidth="120"
                Click="CloseButton_Click"
                Content="{x:Static resources:Resource.Close}" />
        </StackPanel>
    </Grid>
</local:BaseWindow>

