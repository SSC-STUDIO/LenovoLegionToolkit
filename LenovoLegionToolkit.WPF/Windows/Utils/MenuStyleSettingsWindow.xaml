<local:BaseWindow
    x:Class="LenovoLegionToolkit.WPF.Windows.Utils.MenuStyleSettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:wpfui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:resources="clr-namespace:LenovoLegionToolkit.WPF.Resources"
    xmlns:local="clr-namespace:LenovoLegionToolkit.WPF.Windows"
    xmlns:conv="clr-namespace:System.Windows.Controls;assembly=PresentationFramework"
    xmlns:utils="clr-namespace:LenovoLegionToolkit.WPF.Utils"
    Title="{x:Static resources:Resource.SystemBeautification_MenuStyleSettings_Title}"
    Height="600"
    Width="800"
    WindowStartupLocation="CenterOwner"
    ResizeMode="CanResize"
    ShowInTaskbar="False"
    FlowDirection="{x:Static utils:LocalizationHelper.Direction}">

    <Window.Resources>
        <conv:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <!-- Browser-style Tab RadioButton Style -->
        <Style TargetType="RadioButton" x:Key="ConfigTabRadioButtonStyle">
            <Setter Property="Margin" Value="0,0,0,0" />
            <Setter Property="Padding" Value="20,10" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
            <Setter Property="Background" Value="{DynamicResource ControlFillColorTertiaryBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="1,1,1,0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border
                            x:Name="RootBorder"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="8,8,0,0"
                            Padding="{TemplateBinding Padding}"
                            Margin="{TemplateBinding Margin}">
                            <ContentPresenter
                                x:Name="ContentPresenter"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                RecognizesAccessKey="True"
                                Content="{TemplateBinding Content}"
                                ContentTemplate="{TemplateBinding ContentTemplate}"
                                TextElement.FontWeight="{TemplateBinding FontWeight}"
                                TextElement.FontSize="{TemplateBinding FontSize}"
                                TextElement.Foreground="{TemplateBinding Foreground}" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}" />
                                <Setter TargetName="RootBorder" Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                                <Setter TargetName="RootBorder" Property="BorderThickness" Value="1,1,1,0" />
                                <Setter TargetName="RootBorder" Property="Margin" Value="0,-4,0,0" />
                                <Setter TargetName="RootBorder" Property="Padding" Value="20,14" />
                                <Setter TargetName="ContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsChecked" Value="False">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorTertiaryBrush}" />
                                <Setter TargetName="RootBorder" Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                                <Setter TargetName="RootBorder" Property="Padding" Value="20,10" />
                                <Setter TargetName="ContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                                <Setter TargetName="ContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsChecked" Value="True" />
                                    <Condition Property="IsMouseOver" Value="True" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                            </MultiTrigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}" />
                                <Setter TargetName="RootBorder" Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                                <Setter TargetName="ContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource TextFillColorTertiaryBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Instructions -->
        <wpfui:CardControl Grid.Row="0" Margin="20,20,20,12">
            <wpfui:CardControl.Header>
                <TextBlock
                    FontSize="16"
                    FontWeight="Medium"
                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                    Text="{x:Static resources:Resource.MenuStyleSettingsWindow_ConfigEditor_Usage}" />
            </wpfui:CardControl.Header>
            <StackPanel Margin="0,8,0,0">
                <TextBlock
                    FontSize="13"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    TextWrapping="Wrap"
                    LineHeight="20"
                    Margin="0,0,0,8">
                    <Run Text="{x:Static resources:Resource.MenuStyleSettingsWindow_ConfigEditor_Description}" />
                    <Run Text="{x:Static resources:Resource.MenuStyleSettingsWindow_ConfigEditor_ApplyButton}" FontWeight="Bold" />
                    <Run Text="{x:Static resources:Resource.MenuStyleSettingsWindow_ConfigEditor_ApplyDescription}" />
                </TextBlock>
                <TextBlock
                    FontSize="13"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    TextWrapping="Wrap"
                    LineHeight="20"
                    Margin="0,0,0,8">
                    <Run Text="{x:Static resources:Resource.MenuStyleSettingsWindow_ConfigEditor_ConfigPath}" />
                    <Run x:Name="_configPathTextBlock" />
                </TextBlock>
                <TextBlock
                    FontSize="13"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    TextWrapping="Wrap"
                    LineHeight="20"
                    Text="{x:Static resources:Resource.MenuStyleSettingsWindow_ConfigEditor_RestartNote}" />
            </StackPanel>
        </wpfui:CardControl>

        <!-- Text Editor with Tabs -->
        <wpfui:CardControl Grid.Row="1" Margin="20,0,20,12">
            <Grid Margin="0,8,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="1" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Tab Navigation -->
                <Border
                    Grid.Row="0"
                    Background="Transparent"
                    Margin="0,0,0,0"
                    ClipToBounds="False">
                    <ScrollViewer
                        VerticalScrollBarVisibility="Disabled"
                        HorizontalScrollBarVisibility="Auto"
                        VerticalContentAlignment="Center"
                        ClipToBounds="False">
                        <Border Padding="0,2,0,0" ClipToBounds="False">
                            <StackPanel Orientation="Horizontal" ClipToBounds="False">
                                <RadioButton
                                    x:Name="_shellNssTab"
                                    Style="{StaticResource ConfigTabRadioButtonStyle}"
                                    GroupName="ConfigFileTabs"
                                    Content="shell.nss"
                                    IsChecked="True"
                                    Checked="ShellNssTab_Checked" />
                                <RadioButton
                                    x:Name="_themeNssTab"
                                    Style="{StaticResource ConfigTabRadioButtonStyle}"
                                    GroupName="ConfigFileTabs"
                                    Content="theme.nss"
                                    Checked="ThemeNssTab_Checked" />
                                <RadioButton
                                    x:Name="_imagesNssTab"
                                    Style="{StaticResource ConfigTabRadioButtonStyle}"
                                    GroupName="ConfigFileTabs"
                                    Content="images.nss"
                                    Checked="ImagesNssTab_Checked" />
                                <RadioButton
                                    x:Name="_modifyNssTab"
                                    Style="{StaticResource ConfigTabRadioButtonStyle}"
                                    GroupName="ConfigFileTabs"
                                    Content="modify.nss"
                                    Checked="ModifyNssTab_Checked" />
                            </StackPanel>
                        </Border>
                    </ScrollViewer>
                </Border>

                <!-- Separator Line -->
                <Border 
                    Grid.Row="1"
                    Height="1"
                    Background="{DynamicResource ControlStrokeColorDefaultBrush}"
                    HorizontalAlignment="Stretch"
                    SnapsToDevicePixels="True" />

                <!-- Tab Content -->
                <Grid Grid.Row="2" Background="{DynamicResource ControlFillColorDefaultBrush}">
                    <!-- Single ScrollViewer for all tabs -->
                    <ScrollViewer
                        x:Name="_tabContentScrollViewer"
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Auto"
                        VerticalAlignment="Stretch"
                        HorizontalAlignment="Stretch">
                        
                        <!-- Tab Content Container -->
                        <Grid>
                            <!-- Shell.nss Content -->
                            <Grid Visibility="{Binding IsChecked, ElementName=_shellNssTab, Converter={StaticResource BoolToVisibilityConverter}}" Width="750" Height="400" HorizontalAlignment="Center" VerticalAlignment="Center" Background="{DynamicResource ControlFillColorDefaultBrush}">
                                <StackPanel Orientation="Vertical" Padding="20" VerticalAlignment="Center">
                                    <TextBlock Text="shell.nss 配置文件" FontSize="16" FontWeight="Medium" HorizontalAlignment="Center" Margin="0,0,0,16" />
                                    <TextBlock Text="shell.nss 文件用于定义右键菜单的整体结构和行为" FontSize="14" TextWrapping="Wrap" HorizontalAlignment="Center" Margin="0,0,0,20" />
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <wpfui:Button x:Name="_openShellNssBtn" Content="打开 shell.nss 文件" MinWidth="150" Click="OpenShellNssBtn_Click" Margin="0,0,12,0" />
                                        <wpfui:Button x:Name="_openShellNssFolderBtn" Content="打开所在文件夹" MinWidth="150" Click="OpenShellNssFolderBtn_Click" />
                                    </StackPanel>
                                    <TextBlock Text="路径：" FontSize="12" Margin="0,20,0,0" />
                                    <TextBox x:Name="_shellNssPathTextBox" IsReadOnly="True" Background="{DynamicResource ControlFillColorSecondaryBrush}" BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}" BorderThickness="1" Padding="8" Height="30" />
                                </StackPanel>
                            </Grid>
                            
                            <!-- Theme.nss Content -->
                            <Grid Visibility="{Binding IsChecked, ElementName=_themeNssTab, Converter={StaticResource BoolToVisibilityConverter}}" Width="750" Height="400" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <!-- Theme UI Settings -->
                                <TabControl Width="750" Height="400" Background="{DynamicResource ControlFillColorDefaultBrush}">
                                    <!-- UI Settings Tab -->
                                    <TabItem Header="UI 设置" Background="{DynamicResource ControlFillColorDefaultBrush}">
                                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" Padding="8">
                                            <StackPanel Orientation="Vertical" Margin="0,0,0,16">
                                                <!-- Basic Theme Settings -->
                                                <wpfui:CardControl Margin="0">
                                                    <wpfui:CardControl.Header>
                                                        <TextBlock FontSize="14" FontWeight="Medium" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Text="基础主题设置" />
                                                    </wpfui:CardControl.Header>
                                                    <StackPanel Orientation="Vertical" Margin="0,8,0,0">
                                                        <!-- Background Color -->
                                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16" VerticalAlignment="Center">
                                                            <TextBlock Width="150" Text="背景颜色:" VerticalAlignment="Center" />
                                                            <TextBox x:Name="_backgroundColorTextBox" Width="100" Text="#ffffff" Margin="0,0,8,0" />
                                                            <Button x:Name="_backgroundColorPicker" Width="40" Height="24" Background="#ffffff" BorderThickness="1" BorderBrush="#cccccc" />
                                                        </StackPanel>
                                                        
                                                        <!-- Text Color -->
                                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16" VerticalAlignment="Center">
                                                            <TextBlock Width="150" Text="文本颜色:" VerticalAlignment="Center" />
                                                            <TextBox x:Name="_textColorTextBox" Width="100" Text="#000000" Margin="0,0,8,0" />
                                                            <Button x:Name="_textColorPicker" Width="40" Height="24" Background="#000000" BorderThickness="1" BorderBrush="#cccccc" />
                                                        </StackPanel>
                                                    </StackPanel>
                                                </wpfui:CardControl>
                                                
                                                <!-- Hover Settings -->
                                                <wpfui:CardControl Margin="0">
                                                    <wpfui:CardControl.Header>
                                                        <TextBlock FontSize="14" FontWeight="Medium" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Text="悬停效果设置" />
                                                    </wpfui:CardControl.Header>
                                                    <StackPanel Orientation="Vertical" Margin="0,8,0,0">
                                                        <!-- Hover Background Color -->
                                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16" VerticalAlignment="Center">
                                                            <TextBlock Width="150" Text="悬停背景:" VerticalAlignment="Center" />
                                                            <TextBox x:Name="_hoverBackgroundColorTextBox" Width="100" Text="#f0f0f0" Margin="0,0,8,0" />
                                                            <Button x:Name="_hoverBackgroundColorPicker" Width="40" Height="24" Background="#f0f0f0" BorderThickness="1" BorderBrush="#cccccc" />
                                                        </StackPanel>
                                                        
                                                        <!-- Hover Text Color -->
                                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16" VerticalAlignment="Center">
                                                            <TextBlock Width="150" Text="悬停文本:" VerticalAlignment="Center" />
                                                            <TextBox x:Name="_hoverTextColorTextBox" Width="100" Text="#000000" Margin="0,0,8,0" />
                                                            <Button x:Name="_hoverTextColorPicker" Width="40" Height="24" Background="#000000" BorderThickness="1" BorderBrush="#cccccc" />
                                                        </StackPanel>
                                                    </StackPanel>
                                                </wpfui:CardControl>
                                                
                                                <!-- Selected Settings -->
                                                <wpfui:CardControl Margin="0">
                                                    <wpfui:CardControl.Header>
                                                        <TextBlock FontSize="14" FontWeight="Medium" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Text="选中效果设置" />
                                                    </wpfui:CardControl.Header>
                                                    <StackPanel Orientation="Vertical" Margin="0,8,0,0">
                                                        <!-- Selected Background Color -->
                                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16" VerticalAlignment="Center">
                                                            <TextBlock Width="150" Text="选中背景:" VerticalAlignment="Center" />
                                                            <TextBox x:Name="_selectedBackgroundColorTextBox" Width="100" Text="#0078d4" Margin="0,0,8,0" />
                                                            <Button x:Name="_selectedBackgroundColorPicker" Width="40" Height="24" Background="#0078d4" BorderThickness="1" BorderBrush="#cccccc" />
                                                        </StackPanel>
                                                        
                                                        <!-- Selected Text Color -->
                                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16" VerticalAlignment="Center">
                                                            <TextBlock Width="150" Text="选中文本:" VerticalAlignment="Center" />
                                                            <TextBox x:Name="_selectedTextColorTextBox" Width="100" Text="#ffffff" Margin="0,0,8,0" />
                                                            <Button x:Name="_selectedTextColorPicker" Width="40" Height="24" Background="#ffffff" BorderThickness="1" BorderBrush="#cccccc" />
                                                        </StackPanel>
                                                    </StackPanel>
                                                </wpfui:CardControl>
                                                
                                                <!-- Update Button -->
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,8">
                                                    <wpfui:Button x:Name="_updateFromUIBtn" Content="从UI更新文本" MinWidth="120" Click="UpdateFromUIBtn_Click" />
                                                    <wpfui:Button x:Name="_loadToUIBtn" Content="从文本加载" MinWidth="120" Click="LoadToUIBtn_Click" />
                                                </StackPanel>
                                            </StackPanel>
                                        </ScrollViewer>
                                    </TabItem>
                                    
                                    <!-- Text Editor Tab -->
                                    <TabItem Header="文本编辑器" Background="{DynamicResource ControlFillColorDefaultBrush}">
                                        <Grid Width="750" Height="400">
                                            <StackPanel Orientation="Vertical" Height="400">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="8">
                                                    <wpfui:Button x:Name="_openThemeNssBtn" Content="在外部编辑器打开" MinWidth="150" Click="OpenThemeNssBtn_Click" />
                                                </StackPanel>
                                                <TextBox
                                                    x:Name="_themeNssTextBox"
                                                    FontFamily="Consolas, Courier New"
                                                    FontSize="12"
                                                    AcceptsReturn="True"
                                                    AcceptsTab="True"
                                                    TextWrapping="NoWrap"
                                                    VerticalScrollBarVisibility="Auto"
                                                    HorizontalScrollBarVisibility="Auto"
                                                    Background="{DynamicResource ControlFillColorDefaultBrush}"
                                                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                                    BorderThickness="1"
                                                    Padding="8"
                                                    Width="750"
                                                    Height="350"
                                                    HorizontalAlignment="Center" />
                                            </StackPanel>
                                        </Grid>
                                    </TabItem>
                                </TabControl>
                            </Grid>
                            
                            <!-- Images.nss Content -->
                            <Grid Visibility="{Binding IsChecked, ElementName=_imagesNssTab, Converter={StaticResource BoolToVisibilityConverter}}" Width="750" Height="400" HorizontalAlignment="Center" VerticalAlignment="Center" Background="{DynamicResource ControlFillColorDefaultBrush}">
                                <StackPanel Orientation="Vertical" Padding="20" VerticalAlignment="Center">
                                    <TextBlock Text="images.nss 配置文件" FontSize="16" FontWeight="Medium" HorizontalAlignment="Center" Margin="0,0,0,16" />
                                    <TextBlock Text="images.nss 文件用于定义右键菜单的图标和图像" FontSize="14" TextWrapping="Wrap" HorizontalAlignment="Center" Margin="0,0,0,20" />
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <wpfui:Button x:Name="_openImagesNssBtn" Content="打开 images.nss 文件" MinWidth="150" Click="OpenImagesNssBtn_Click" Margin="0,0,12,0" />
                                        <wpfui:Button x:Name="_openImagesNssFolderBtn" Content="打开所在文件夹" MinWidth="150" Click="OpenImagesNssFolderBtn_Click" />
                                    </StackPanel>
                                    <TextBlock Text="路径：" FontSize="12" Margin="0,20,0,0" />
                                    <TextBox x:Name="_imagesNssPathTextBox" IsReadOnly="True" Background="{DynamicResource ControlFillColorSecondaryBrush}" BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}" BorderThickness="1" Padding="8" Height="30" />
                                </StackPanel>
                            </Grid>
                            
                            <!-- Modify.nss Content -->
                            <Grid Visibility="{Binding IsChecked, ElementName=_modifyNssTab, Converter={StaticResource BoolToVisibilityConverter}}" Width="750" Height="400" HorizontalAlignment="Center" VerticalAlignment="Center" Background="{DynamicResource ControlFillColorDefaultBrush}">
                                <StackPanel Orientation="Vertical" Padding="20" VerticalAlignment="Center">
                                    <TextBlock Text="modify.nss 配置文件" FontSize="16" FontWeight="Medium" HorizontalAlignment="Center" Margin="0,0,0,16" />
                                    <TextBlock Text="modify.nss 文件用于修改和自定义右键菜单项" FontSize="14" TextWrapping="Wrap" HorizontalAlignment="Center" Margin="0,0,0,20" />
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <wpfui:Button x:Name="_openModifyNssBtn" Content="打开 modify.nss 文件" MinWidth="150" Click="OpenModifyNssBtn_Click" Margin="0,0,12,0" />
                                        <wpfui:Button x:Name="_openModifyNssFolderBtn" Content="打开所在文件夹" MinWidth="150" Click="OpenModifyNssFolderBtn_Click" />
                                    </StackPanel>
                                    <TextBlock Text="路径：" FontSize="12" Margin="0,20,0,0" />
                                    <TextBox x:Name="_modifyNssPathTextBox" IsReadOnly="True" Background="{DynamicResource ControlFillColorSecondaryBrush}" BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}" BorderThickness="1" Padding="8" Height="30" />
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </ScrollViewer>
                </Grid>
            </Grid>
        </wpfui:CardControl>

        <StackPanel
            Grid.Row="2"
            Margin="20"
            HorizontalAlignment="Right"
            Orientation="Horizontal">
            <wpfui:Button
                x:Name="_applyButton"
                MinWidth="120"
                Margin="0,0,8,0"
                Click="ApplyButton_Click"
                Content="应用" />
            <wpfui:Button
                x:Name="_closeButton"
                MinWidth="120"
                Click="CloseButton_Click"
                Content="{x:Static resources:Resource.Close}" />
        </StackPanel>
    </Grid>
</local:BaseWindow>

